
<%- include('../partials/header') %>

<main>

<section class="h-14 text-center mt-7 p-4">
    <span class="michroma-regular text-2xl ">YOUR CART</span>
    <p class="mt-5  border-b border-gray-950"></p>
</section>
<div class="flex">
    
<section class="mt-16">
    <div class="bg-white flex">
        <div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-1 lg:max-w-7xl lg:px-8">
            <div class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-4 xl:gap-x-8">
                <!-- First Product -->
                <% items.products.forEach(product => { %>
                    <div class="">
                        <div class="aspect-h-1 aspect-w-1 w-full overflow-hidden rounded-md bg-gray-200 lg:aspect-none group-hover:opacity-75 lg:h-80">
                            <img src="./product_images/<%= product.productImage %>">
                        </div>
                                    
                        <div class="mt-4 flex justify-between">
                            <div>
                                <h3 class="text-sm text-gray-700">
                                    <a href="/product/<%= product._id %>">
                                        <span aria-hidden="true" class=""></span>
                                        <%= product.productName %>
                                    </a>
                                </h3>
                                <p class="mt-1 text-sm text-gray-500"><%= product.color %></p>
                            </div>
                            <p class="text-sm font-medium text-gray-900"><%= product.price %></p>    
                        </div>
                
                        <div class="justify-center items-center text-center mt-6">
                            <div class="flex gap-2">
                              
                                <% const cartItem = items.cart.find(item => item.productId.toString() === product._id.toString()) %>
                                <% if (cartItem) { %>
                                    <img onclick="removeCart('<%= cartItem._id %>')" src="/images/x-letter.svg" class="h-6 w-6 ml-5 border-2 border-gray-950 rounded-full" alt="Remove">
                                <% } %>
                                
                           
                                <% if (cartItem) { %>
                                    <% for (let i = 1; i <= 1; i++) { %>
                                        <span class="text-gray-950 h-6 w-6 ml-44 border-2 border-gray-950 rounded-full font-bold" value="2"> <%= cartItem.quantity %> </span>
                                        <% } %>
                                <% } else { %>
                                    <span class="text-gray-950" value="0"> Out of stock </span>
                                <% } %>
                            </select>
                            </div>
                        </div>
                    </div>
                <% }) %>

                <section class="flex-row">
                    <% const cartItem = items.cart.find(item => item.productId.toString()); %>
                    <% let totalPrice = 0; %> 
                    <% items.cart.forEach(cartItem => { %>
                        <% const product = items.products.find(prod => prod._id.toString() === cartItem.productId.toString()); %>
                        <% if (product) { %>
                            <% totalPrice += product.price * cartItem.quantity; %>
                        <% } %>
                    <% }); %>
                    
                    <span class="font-bold"> Total: <%= totalPrice %>  </span><br><br>  
                    <a href="/checkout/<%= cartItem._id %>/<%= totalPrice %>" class="m-20 cursor-pointer text-center w-48 h-8 rounded-full bg-transparent hover:bg-cyan-400 text-gray-700 font-semibold hover:text-white text-xs py-2 px-4 border border-gray-700 hover:border-transparent">
                        Checkout
                    </a>
                </section>
                
    </div>
</section>
</div>
</main>
<script>
const removeCart = (itemId) => {
    const url = `http://localhost:4000/removeCart/${itemId}`;
    fetch(url, {
        method: 'GET'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log("Item removed successfully:", data);
    })
    .catch(error => {
        console.error('Error removing item:', error);
    });
};

    </script>

<%- include('../partials/footer') %>